{"version":3,"sources":["../src/index.tsx","../src/NextUnsavedChangesGuard.tsx"],"sourcesContent":["export { NextUnsavedChangesGuard } from \"./NextUnsavedChangesGuard\";\n","\"use client\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport { useRouter } from \"next/navigation\";\n\nconst alertDialogCSS = `\n      .nucg-ad-overlay {\n        position: fixed;\n        inset: 0;\n        background: rgba(0,0,0,0.45);\n        backdrop-filter: blur(2px);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 50;\n        animation: ad-fade-in .15s ease-out;\n      }\n\n      .nucg-ad-dialog {\n        width: 100%;\n        max-width: 420px;\n        background: #ffffff;\n        border-radius: 12px;\n        padding: 24px;\n        box-shadow:\n          0 10px 30px rgba(0,0,0,0.15),\n          0 1px 2px rgba(0,0,0,0.1);\n        animation: ad-scale-in .15s ease-out;\n      }\n\n      .nucg-ad-title {\n        font-size: 1.125rem;\n        font-weight: 600;\n        color: #111827;\n        margin-bottom: 6px;\n      }\n\n      .nucg-ad-description {\n        font-size: 0.95rem;\n        color: #6b7280;\n        line-height: 1.45;\n      }\n\n      .nucg-ad-footer {\n        display: flex;\n        justify-content: flex-end;\n        gap: 10px;\n        margin-top: 20px;\n      }\n\n      .nucg-ad-btn {\n        padding: 8px 14px;\n        border-radius: 8px;\n        font-size: 0.875rem;\n        border: none;\n        cursor: pointer;\n        transition: background .15s ease, transform .05s ease;\n      }\n\n      .nucg-ad-btn:active {\n        transform: scale(0.97);\n      }\n\n      .nucg-ad-cancel {\n        background: #f3f4f6;\n        color: #111827;\n      }\n      .nucg-ad-cancel:hover {\n        background: #e5e7eb;\n      }\n\n      .nucg-ad-danger {\n        background: #fee2e2;\n        color: #b91c1c;\n      }\n      .nucg-ad-danger:hover {\n        background: #fecaca;\n      }\n\n      .nucg-ad-primary {\n        background: #111827;\n        color: #ffffff;\n      }\n      .nucg-ad-primary:hover {\n        background: #1f2937;\n      }\n\n      @keyframes nucg-ad-fade-in {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n\n      @keyframes nucg-ad-scale-in {\n        from { transform: scale(.96); opacity: 0; }\n        to { transform: scale(1); opacity: 1; }\n      }\n`;\n\ninterface UnsavedChangesGuardProps {\n  children: React.ReactNode;\n  formDirty: boolean;\n  saveData: () => Promise<void>;\n  formErrors?: Record<string, any>;\n}\n\nexport const NextUnsavedChangesGuard = ({\n  children,\n  formDirty,\n  saveData,\n  formErrors = {},\n}: UnsavedChangesGuardProps) => {\n  const [isDirty, setDirty] = useState(formDirty);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [nextRoute, setNextRoute] = useState<string | null>(null);\n  const router = useRouter();\n  const isRouteChanging = useRef(false);\n\n  // Sync isDirty with formDirty prop\n  useEffect(() => {\n    setDirty(formDirty);\n  }, [formDirty]);\n\n  // Handle browser close/refresh\n  useEffect(() => {\n    const handleWindowClose = (e: BeforeUnloadEvent) => {\n      if (!isDirty) return;\n      e.preventDefault();\n      e.returnValue =\n        \"You have unsaved changes. Are you sure you want to leave?\";\n    };\n\n    window.addEventListener(\"beforeunload\", handleWindowClose);\n    return () => {\n      window.removeEventListener(\"beforeunload\", handleWindowClose);\n    };\n  }, [isDirty]);\n\n  // Intercept route changes\n  useEffect(() => {\n    const originalPush = router.push;\n\n    router.push = (url: string) => {\n      if (isDirty && !isRouteChanging.current) {\n        setNextRoute(url);\n        setIsDialogOpen(true);\n        return Promise.resolve(); // Prevent navigation without throwing\n      }\n      isRouteChanging.current = false;\n      return originalPush(url);\n    };\n\n    return () => {\n      router.push = originalPush;\n    };\n  }, [isDirty, router]);\n\n  // Handle \"Save\" action\n  const handleSave = async () => {\n    if (Object.keys(formErrors).length === 0) {\n      try {\n        await saveData();\n        setDirty(false);\n        setIsDialogOpen(false);\n        if (nextRoute) {\n          isRouteChanging.current = true;\n          router.push(nextRoute);\n        }\n      } catch (error) {\n        console.log(\"Error saving changes\");\n      }\n    } else {\n      setIsDialogOpen(false);\n      console.log(\"Form contains errors\");\n    }\n  };\n\n  // Handle \"Discard\" action\n  const handleDiscard = () => {\n    setDirty(false);\n    setIsDialogOpen(false);\n    if (nextRoute) {\n      isRouteChanging.current = true;\n      router.push(nextRoute);\n    }\n  };\n\n  // Handle \"Stay\" action\n  const handleStay = () => {\n    setIsDialogOpen(false);\n    setNextRoute(null);\n  };\n\n  function injectAlertDialogStyles() {\n    if (typeof document === \"undefined\") return;\n\n    if (!document.getElementById(\"alert-dialog-styles\")) {\n      const style = document.createElement(\"style\");\n      style.id = \"alert-dialog-styles\";\n      style.textContent = alertDialogCSS;\n      document.head.appendChild(style);\n    }\n  }\n\n  useEffect(() => {\n    injectAlertDialogStyles();\n  }, []);\n\n  return (\n    <>\n      {children}\n      {isDialogOpen && (\n        <div className=\"nucg-ad-overlay\">\n          <div className=\"nucg-ad-dialog\" role=\"alertdialog\" aria-modal=\"true\">\n            <div>\n              <h2 className=\"nucg-ad-title\">Unsaved Changes</h2>\n              <p className=\"nucg-ad-description\">\n                You have unsaved changes. Do you want to save them before\n                leaving?\n              </p>\n            </div>\n\n            <div className=\"nucg-ad-footer\">\n              <button\n                className=\"nucg-ad-btn nucg-ad-cancel\"\n                onClick={handleStay}\n              >\n                Stay\n              </button>\n\n              <button\n                className=\"nucg-ad-btn nucg-ad-danger\"\n                onClick={handleDiscard}\n              >\n                Discard\n              </button>\n\n              <button\n                className=\"nucg-ad-btn nucg-ad-primary\"\n                onClick={handleSave}\n              >\n                Save\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n};\n"],"mappings":"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","names":[]}